# Описание системы уведомлений

## 1. Инициализация веб-сокет сервера (MyGateway)

При создании экземпляра `MyGateway`, инициализируются клиенты (`this.clients`), сервис уведомлений (`this.notificationService`) и сервис очереди уведомлений (`this.notificationQueue`). 

В методе `onModuleInit`, в зависимости от окружения, создается HTTP или HTTPS сервер, который затем используется для создания веб-сокет сервера (`WebSocketServer`). Веб-сокет сервер слушает подключения клиентов, обрабатывает сообщения и отключения.

## 2. Отправка уведомлений (NotificationService)

`NotificationService` содержит методы для отправки различных типов уведомлений (например, создание задачи, обновление статуса задачи и т.д.). Метод `sendNotification` используется для отправки уведомлений, где определяются получатели и формируется сообщение для отправки через `gateway.sendMessage`.

## 3. Управление очередью уведомлений (NotificationQueue)

`NotificationQueue` использует библиотеку bull для управления очередью уведомлений в Redis. Метод `addNotificationJob` добавляет задачи уведомлений в очередь с возможной задержкой. `setupQueue` настраивает обработку задач из очереди, включая отправку уведомлений через `gateway.sendMessage`. `cleanQueue` очищает выполненные и неудачные задачи из очереди.

## 4. Взаимодействие через веб-сокеты (MyGateway.sendMessage)

Метод `sendMessage` в `MyGateway` используется для отправки уведомлений клиентам через веб-сокеты. Он фильтрует подключенных клиентов по идентификаторам получателей и отправляет им уведомления.

## Общий процесс

1. Клиенты подключаются к веб-сокет серверу.
2. При наступлении события (например, создание задачи) вызывается соответствующий метод в `NotificationService` для отправки уведомления.
3. Если уведомление требует задержки или пакетной обработки, оно добавляется в очередь `NotificationQueue`.
4. `NotificationQueue` обрабатывает задачи по мере их поступления, отправляя уведомления через `MyGateway`.
5. `MyGateway` отправляет уведомления подключенным клиентам через веб-сокеты.

Эта система позволяет эффективно управлять уведомлениями в реальном времени, обеспечивая масштабируемость и отказоустойчивость благодаря использованию очередей и веб-сокетов.
